name: Get Hot News

on:
  schedule:
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # âš ï¸ è¯•ç”¨ç‰ˆè¯´æ˜ / Trial Mode
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    #
    # ğŸ”„ è¿è¡Œæœºåˆ¶ / How it works:
    #    - æ¯ä¸ªå‘¨æœŸä¸º 7 å¤©ï¼Œå±Šæ—¶è‡ªåŠ¨åœæ­¢
    #    - è¿è¡Œ "Check In" ä¼šé‡ç½®å‘¨æœŸï¼ˆé‡æ–°å¼€å§‹ 7 å¤©å€’è®¡æ—¶ï¼Œè€Œéç´¯åŠ ï¼‰
    #    - Each cycle is 7 days, then auto-stops
    #    - "Check In" resets the cycle (restarts 7-day countdown, not cumulative)
    #
    # ğŸ’¡ è®¾è®¡åˆè¡· / Why this design:
    #    å¦‚æœ 7 å¤©éƒ½å¿˜äº†ç­¾åˆ°ï¼Œæˆ–è®¸è¿™äº›èµ„è®¯å¯¹ä½ æ¥è¯´å¹¶éåˆšéœ€
    #    é€‚æ—¶çš„æš‚åœï¼Œèƒ½å¸®ä½ ä»ä¿¡æ¯æµä¸­æŠ½ç¦»ï¼Œç»™å¤§è„‘ç•™å‡ºå–˜æ¯çš„ç©ºé—´
    #    If you forget for 7 days, maybe you don't really need it
    #    A timely pause helps you detach from the stream and gives your mind space
    #
    # ğŸ™ çæƒœèµ„æº / Respect shared resources:
    #    GitHub Actions æ˜¯å¹³å°æä¾›çš„å…¬å…±èµ„æºï¼Œæ¯æ¬¡è¿è¡Œéƒ½ä¼šæ¶ˆè€—ç®—åŠ›
    #    ç­¾åˆ°æœºåˆ¶ç¡®ä¿èµ„æºåˆ†é…ç»™çœŸæ­£éœ€è¦çš„ç”¨æˆ·ï¼Œæ„Ÿè°¢ä½ çš„ç†è§£ä¸é…åˆ
    #    GitHub Actions is a shared public resource provided by the platform
    #    Check-in ensures resources go to those who truly need it â€” thank you
    #
    # ğŸš€ é•¿æœŸä½¿ç”¨è¯·éƒ¨ç½² Docker ç‰ˆæœ¬ / For long-term use, deploy Docker version
    #
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    #
    # ğŸ“ ä¿®æ”¹è¿è¡Œæ—¶é—´ï¼šæ¯å¤©9:00å’Œ18:00ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    # ğŸ“ Run at 9:00 AM and 6:00 PM Beijing Time
    #
    # åŒ—äº¬æ—¶é—´ 9:00 â†’ UTC 1:00
    # åŒ—äº¬æ—¶é—´ 18:00 â†’ UTC 10:00
    #
    - cron: "0 1 * * *"   # æ¯å¤© UTC 1:00ï¼ˆåŒ—äº¬æ—¶é—´9:00ï¼‰
    - cron: "0 10 * * *"  # æ¯å¤© UTC 10:00ï¼ˆåŒ—äº¬æ—¶é—´18:00ï¼‰

  workflow_dispatch:

concurrency:
  group: crawler-${{ github.ref_name }}
  cancel-in-progress: true

permissions:
  contents: read
  actions: write

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout self
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install uv
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.cargo/bin" >> $GITHUB_PATH
          sudo ln -sf /home/runner/.local/bin/uv /usr/local/bin/uv

      - name: Run TrendRadar
        env:
          # ä» GitHub Secrets è¯»å–é€šçŸ¥æ¸ é“é…ç½®
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
          WEWORK_WEBHOOK_URL: ${{ secrets.WEWORK_WEBHOOK_URL }}
          DINGTALK_WEBHOOK_URL: ${{ secrets.DINGTALK_WEBHOOK_URL }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # ä» Secrets è¯»å–å…¶ä»–é…ç½®
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          OLLAMA_BASE_URL: ${{ secrets.OLLAMA_BASE_URL }}
          QIANFAN_API_KEY: ${{ secrets.QIANFAN_API_KEY }}
          ZHIPU_API_KEY: ${{ secrets.ZHIPU_API_KEY }}
          MOONSHOT_API_KEY: ${{ secrets.MOONSHOT_API_KEY }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          uv run main.py

      - name: Commit and push generated outputs
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“° TrendRadar: çƒ­ç‚¹ç›‘æ§æŠ¥å‘Š"
          file_pattern: "output/*"
          commit_user_name: github-actions[bot]
          commit_user_email: github-actions[bot]@users.noreply.github.com
          commit_author: github-actions[bot] <github-actions[bot]@users.noreply.github.com>